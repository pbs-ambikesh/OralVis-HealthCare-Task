
"""prepare_dataset.ipynb

Automatically generated by Colab.

Original file is located at
    https://colab.research.google.com/drive/1n9q8ZyLv_vmMbHdjXWzOJmLdUoS0z02Z
"""

import os
import random
import shutil
from pathlib import Path

# 1. SETUP PATHS 
source_dir = Path('raw_data')

base_output_dir = Path('dataset')

# 2. DEFINE THE SPLIT RATIO
split_ratios = {'train': 0.8, 'val': 0.1, 'test': 0.1}

#  3. CREATE THE DESTINATION DIRECTORIES 
print("Creating new directory structure...")
for split in split_ratios.keys():
    # Create image folders (e.g., dataset/images/train)
    Path(base_output_dir / 'images' / split).mkdir(parents=True, exist_ok=True)
    # Create label folders (e.g., dataset/labels/train)
    Path(base_output_dir / 'labels' / split).mkdir(parents=True, exist_ok=True)
print("Directory structure created successfully.")

# --- 4. GET ALL IMAGE FILES AND SHUFFLE THEM 
image_files = list(source_dir.glob('*.jpg'))
# We shuffle the list randomly to ensure a fair and unbiased split.
random.shuffle(image_files)

# --- 5. CALCULATE SPLIT SIZES ---
total_files = len(image_files)
train_split_index = int(total_files * split_ratios['train'])
val_split_index = int(total_files * (split_ratios['train'] + split_ratios['val']))

# --- 6. SPLIT THE FILES INTO LISTS ---
train_files = image_files[:train_split_index]
val_files = image_files[train_split_index:val_split_index]
test_files = image_files[val_split_index:]

# A dictionary to hold our split lists for easier processing.
file_splits = {
    'train': train_files,
    'val': val_files,
    'test': test_files
}

# 7. COPY FILES TO THEIR NEW HOMES 
print("Starting to copy files...")
for split, files in file_splits.items():
    print(f"Processing {split} set ({len(files)} files)...")
    for image_path in files:
        # Corresponding label file path by changing the extension from .jpg to .txt
        label_path = image_path.with_suffix('.txt')

        # Define the destination paths
        dest_image_path = base_output_dir / 'images' / split / image_path.name
        dest_label_path = base_output_dir / 'labels' / split / label_path.name

        # Copy the image file
        shutil.copy2(image_path, dest_image_path)
        # Copy the label file
        shutil.copy2(label_path, dest_label_path)

print("\n--- All Done! ---")
print(f"Total images processed: {total_files}")
print(f"Training images: {len(train_files)}")
print(f"Validation images: {len(val_files)}")
print(f"Test images: {len(test_files)}")